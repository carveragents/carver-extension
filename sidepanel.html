<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carver Agents</title>
    <link rel="stylesheet" href="styles/sidepanel.css">
</head>
<body>
    <div id="app">
        <!-- Loading State -->
        <div id="loading" class="screen">
            <div class="header">
                <h1>Carver Agents</h1>
            </div>
            <div class="loading-spinner">
                <div class="spinner"></div>
                <p>Loading...</p>
            </div>
        </div>

        <!-- API Key Setup Screen -->
        <div id="api-key-setup" class="screen hidden">
            <div class="login-container">
                <div class="login-header">
                    <img src="icons/icon32.png" alt="Carver Agents" class="login-logo">
                    <h1 class="login-brand">Carver Agents</h1>
                    <p class="login-subtitle">Real-time Contextual Intelligence<br />Anytime, Anywhere</p>
                </div>
                
                <div class="login-form">
                    <h2 class="login-title">Log in</h2>
                    
                    <div class="form-group">
                        <div class="input-with-button">
                            <input type="password" id="api-key-input" placeholder="Enter your API key">
                            <button type="button" id="toggle-api-key-visibility" class="input-show-btn">
                                Show
                            </button>
                        </div>
                        <div id="api-key-error" class="error-message hidden"></div>
                    </div>
                    
                    <p class="api-key-help">
                        Don't have an API key? Email us at 
                        <a href="mailto:support@carveragents.ai">support@carveragents.ai</a>
                    </p>
                    
                    <button id="validate-api-key" class="btn btn-primary login-btn">
                        <span class="btn-text">Continue</span>
                        <div class="btn-spinner hidden"></div>
                    </button>
                    
                    <!-- Hidden environment selector - keeping for functionality -->
                    <select id="host-select" style="display: none;">
                        <option value="https://app.carveragents.ai">Production (app.carveragents.ai)</option>
                        <option value="https://staging.carveragents.ai">Staging (staging.carveragents.ai)</option>
                        <option value="http://localhost:8000">Local Development (localhost:8000)</option>
                    </select>
                </div>
                
                <div class="login-footer">
                    <p class="footer-text">
                        By logging in, you acknowledge that you have read and understood, and agree to 
                        Carver Agents' <a href="https://carveragents.ai/terms-and-conditions" target="_blank">Terms</a> and <a href="https://carveragents.ai/privacy-policy" target="_blank">Privacy Policy</a>.
                    </p>
                    <p class="website-link">
                        <a href="https://carveragents.ai" target="_blank" rel="noopener noreferrer">Visit our website</a>
                    </p>
                    <p class="version-text">
                        ¬© Carver Agents Beta-<span id="api-version"></span>
                    </p>
                </div>
            </div>
        </div>

        <!-- Main Dashboard Screen -->
        <div id="main-dashboard" class="screen hidden">
            <div class="header">
                <div class="header-brand">
                    <img src="icons/icon32.png" alt="Carver Agents" class="header-logo">
                    <div class="brand-info">
                        <h1 class="brand-title">Carver Agents</h1>
                    </div>
                </div>

                    <button id="support-btn"  title="Support">
                        <img src="icons/carver-icons/interrogation_help_20x20_white.svg" alt="Help" width="22" height="22">
                    </button>
                    <button id="settings-btn" title="Settings">
                        <img src="icons/carver-icons/setting-icon_20x20_white.svg" alt="Settings" width="22" height="22">
                    </button>

            </div>
            
            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button id="regulatory-tab" class="tab-btn active">RegWatch</button>
                <button id="horizon-tab" class="tab-btn">PartnerWatch</button>
            </div>
            
            <div class="content">
                <!-- Regulatory Tab Content -->
                <div id="regulatory-content" class="tab-content">
                    <!-- Topics Header with Search -->
                    <div class="topics-header">
                        <div class="search-box">
                            <input type="text" id="topics-search-input" placeholder="Search for regulatory institutes">
                            <div id="topics-suggestions" class="topics-suggestions hidden">
                                <!-- Topic suggestions will be dynamically inserted here -->
                            </div>
                        </div>
                        <div class="topics-actions">
                            <button id="subscriptions-btn" class="icon-btn" title="My Subscriptions"><img src="icons/carver-icons/stars_MySubscriptions_14x14.svg" alt="My Subscriptions" width="16" height="16"></button>
                            <button id="refresh-btn" class="icon-btn" title="Refresh"><img src="icons/carver-icons/refresh_14x14.svg" alt="Refresh" width="14" height="14"></button>
                        </div>
                    </div>

                    <!-- Tag Summaries -->
                    <div id="tag-summaries" class="tag-summaries">
                        <!-- Tag cards will be dynamically inserted here -->
                    </div>

                    <!-- Empty State -->
                    <div id="empty-state" class="empty-state hidden">
                        <div class="empty-icon">üìä</div>
                        <h3>Start Monitoring institutes</h3>
                        <p>Search for regulatory institutes to monitor</p>
                        <button id="search-topics-btn" class="btn btn-primary">Search Insitutes</button>
                    </div>
                    
                    <!-- Version Info for Regulatory Tab -->
                    <div class="tab-version-info">
                        <span class="version-info" id="regulatory-version"></span>
                    </div>
                </div>

                <!-- Partner Watch Tab Content -->
                <div id="horizon-content" class="tab-content hidden">
                    <!-- Partner Header with Search -->
                    <div class="partner-header">
                        <div class="search-box">
                            <input type="text" id="partner-search-input" placeholder="Search for partners">
                            <div id="partner-suggestions" class="partner-suggestions hidden">
                                <!-- Partner suggestions will be dynamically inserted here -->
                            </div>
                        </div>
                        <div class="partner-header-actions">
                            <div class="sentiment-filter-container" style="display: none;">
                                <button id="sentiment-filter-btn" class="icon-btn" title="Filter by Sentiment">
                                    <img src="icons/carver-icons/share_18x18.svg" alt="Filter" width="14" height="14" style="transform: rotate(90deg);">
                                </button>
                                <div id="sentiment-filter-dropdown" class="sentiment-filter-dropdown hidden">
                                    <div class="filter-option" data-sentiment="all">All Sentiments</div>
                                    <div class="filter-option" data-sentiment="positive">Positive</div>
                                    <div class="filter-option" data-sentiment="negative">Negative</div>
                                    <div class="filter-option" data-sentiment="neutral">Neutral</div>
                                </div>
                            </div>
                            <button id="add-partner-btn" class="icon-btn" title="Add Partner"><img src="icons/carver-icons/user-add_AddPartner_14x14.svg" alt="Add Partner" width="14" height="14"></button>
                            <button id="horizon-refresh-btn" class="icon-btn" title="Refresh"><img src="icons/carver-icons/refresh_14x14.svg" alt="Refresh" width="14" height="14"></button>
                        </div>
                    </div>

                    <!-- Partners List -->
                    <div id="partners-list" class="partners-list">
                        <!-- Partner items will be dynamically inserted here -->
                    </div>

                    <!-- Empty State for Partner Watch -->
                    <div id="partner-empty-state" class="empty-state hidden">
                        <div class="empty-icon">ü§ù</div>
                        <h3>Start Your Partner Watch</h3>
                        <p>Add partners to monitor news and developments</p>
                        <button id="add-first-partner-btn" class="btn btn-primary">Add Your First Partner</button>
                    </div>
                    
                    <!-- Version Info for Partner Watch Tab -->
                    <div class="tab-version-info">
                        <span class="version-info" id="partner-version"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tag Details Screen -->
        <div id="tag-details" class="screen hidden">
            <div class="header">
                <button id="back-btn" class="icon-btn"><img src="icons/carver-icons/angle-small-left_back_20x20.svg" alt="Back" width="20" height="20"></button>
                <h1 id="tag-details-title"></h1>
            </div>
            
            <div class="content">
                <!-- Summary Title -->
                <div class="section-header">
                    <h3>Summary</h3>
                </div>
                
                <!-- Tag Meta Summary -->
                <div class="meta-summary">
                    <p id="tag-meta-summary"></p>
                    <div class="meta-footer">
                        <small id="tag-last-updated"></small>
                        <button id="share-topic-summary" class="btn btn-small btn-secondary share-summary-btn" title="Share Summary">
                            <img src="icons/carver-icons/share_18x18.svg" alt="Share" width="18" height="18">
                        </button>
                    </div>
                </div>

                <!-- Link Summaries -->
                <div class="link-summaries">
                    <h3>Recent Updates</h3>
                    <div id="link-list">
                        <!-- Link items will be dynamically inserted here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Partner Details Screen -->
        <div id="partner-details" class="screen hidden">
            <div class="header">
                <button id="partner-back-btn" class="icon-btn"><img src="icons/carver-icons/angle-small-left_back_20x20.svg" alt="Back" width="20" height="20"></button>
                <h1 id="partner-details-title"></h1>
            </div>
            
            <div class="content">
                <!-- Summary Title -->
                <div class="section-header">
                    <h3>Summary</h3>
                </div>
                
                <!-- Partner Meta Summary -->
                <div class="meta-summary">
                    <div id="partner-screen-meta-summary" class="meta-summary-content">
                        <p class="no-summary">No summary available yet</p>
                    </div>
                    <small id="partner-screen-last-updated"></small>
                    <div class="sentiment-and-share">
                        <div id="partner-sentiment-indicator" class="sentiment-indicator hidden">
                            <span class="sentiment-label" id="partner-sentiment-label"></span>
                            <div class="sentiment-bar">
                                <div class="sentiment-fill" id="partner-sentiment-fill"></div>
                            </div>
                        </div>
                        <button id="share-partner-summary" class="btn btn-small btn-secondary share-summary-btn" title="Share Summary">
                            <img src="icons/carver-icons/share_18x18.svg" alt="Share" width="18" height="18">
                        </button>
                    </div>
                </div>

                <!-- Partner Recent Updates -->
                <div class="link-summaries">
                    <h3>Recent Updates</h3>
                    <div id="partner-feed-list">
                        <!-- Partner feed items will be dynamically inserted here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Search Results Screen -->
        <div id="search-results" class="screen hidden">
            <div class="header">
                <button id="search-back-btn" class="icon-btn"><img src="icons/carver-icons/angle-small-left_back_20x20.svg" alt="Back" width="20" height="20"></button>
                <h1>Browse Topics</h1>
            </div>
            
            <div class="content">
                <!-- Search Section on Search Screen -->
                <div class="search-section">
                    <div class="search-box">
                        <input type="text" id="search-input" placeholder="Search for topics...">
                        <button id="search-execute-btn" class="icon-btn"><img src="icons/carver-icons/search_17x18.svg" alt="Search" width="17" height="18"></button>
                    </div>
                </div>
                
                <div id="search-results-list">
                    <!-- Search results will be dynamically inserted here -->
                </div>
                
                <div id="search-empty-state" class="empty-state hidden">
                    <p>No topics found matching your search.</p>
                </div>
            </div>
        </div>

        <!-- Subscriptions Screen -->
        <div id="subscriptions-screen" class="screen hidden">
            <div class="header">
                <button id="subscriptions-back-btn" class="icon-btn"><img src="icons/carver-icons/angle-small-left_back_20x20.svg" alt="Back" width="20" height="20"></button>
                <h1>My Subscriptions</h1>
            </div>
            
            <div class="content">
                <div id="subscriptions-list">
                    <!-- Subscriptions will be dynamically inserted here -->
                </div>
                
                <div id="subscriptions-empty-state" class="empty-state hidden">
                    <p>You haven't subscribed to any tags yet.</p>
                    <button id="browse-tags-btn" class="btn btn-primary">Browse Tags</button>
                </div>
            </div>
        </div>

        <!-- Edit Partner Modal -->
        <div id="edit-partner-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Edit Partner</h3>
                    <button id="close-edit-partner-modal" class="modal-close"><img src="icons/carver-icons/close_20x20.svg" alt="Close" width="20" height="20"></button>
                </div>
                <div class="modal-body">
                    <form id="edit-partner-form">
                        <div class="form-group">
                            <label for="edit-partner-input">Partner Name</label>
                            <input type="text" id="edit-partner-input" placeholder="e.g., Microsoft, Tesla, Goldman Sachs" required>
                            <small>Enter a partner name to monitor for news and updates</small>
                            <div id="edit-partner-input-error" class="error-message hidden"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-frequency-select">Search Frequency</label>
                            <select id="edit-frequency-select">
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button id="cancel-edit-partner-btn" class="btn btn-secondary">Cancel</button>
                    <button id="save-edit-partner-btn" class="btn btn-primary">
                        <span class="btn-text">Update Partner</span>
                        <div class="btn-spinner hidden"></div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Add Partner Modal -->
        <div id="add-partner-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Add Partner</h3>
                    <button id="close-partner-modal" class="modal-close"><img src="icons/carver-icons/close_20x20.svg" alt="Close" width="20" height="20"></button>
                </div>
                <div class="modal-body">
                    <form id="partner-form">
                        <div class="form-group">
                            <label for="partner-input">Partner Name</label>
                            <input type="text" id="partner-input" placeholder="e.g., Microsoft, Tesla, Goldman Sachs" required>
                            <small>Enter a partner name to monitor for news and updates</small>
                            <div id="partner-input-error" class="error-message hidden"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="frequency-select">Search Frequency</label>
                            <select id="frequency-select">
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button id="cancel-partner-btn" class="btn btn-secondary">Cancel</button>
                    <button id="save-partner-btn" class="btn btn-primary">
                        <span class="btn-text">Add Partner</span>
                        <div class="btn-spinner hidden"></div>
                    </button>
                </div>
            </div>
        </div>


        <!-- Unsubscribe Confirmation Modal -->
        <div id="unsubscribe-confirm-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Confirm Unsubscribe</h3>
                    <button id="close-unsubscribe-confirm-modal" class="modal-close"><img src="icons/carver-icons/close_20x20.svg" alt="Close" width="20" height="20"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to unsubscribe from <strong id="unsubscribe-topic-name"></strong>?</p>
                    <p>You will no longer receive updates for this institute.</p>
                </div>
                <div class="modal-footer">
                    <button id="cancel-unsubscribe-btn" class="btn btn-secondary">Cancel</button>
                    <button id="confirm-unsubscribe-btn" class="btn btn-danger">
                        <span class="btn-text">Unsubscribe</span>
                        <div class="btn-spinner hidden"></div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Delete Partner Confirmation Modal -->
        <div id="delete-partner-confirm-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Confirm Delete</h3>
                    <button id="close-delete-partner-confirm-modal" class="modal-close"><img src="icons/carver-icons/close_20x20.svg" alt="Close" width="20" height="20"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete <strong id="delete-partner-name"></strong>?</p>
                    <p>This action can't be undone and will remove all associated data.</p>
                </div>
                <div class="modal-footer">
                    <button id="cancel-delete-partner-btn" class="btn btn-secondary">Cancel</button>
                    <button id="confirm-delete-partner-btn" class="btn btn-danger">
                        <span class="btn-text">Delete</span>
                        <div class="btn-spinner hidden"></div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Support Modal -->
        <div id="support-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Support</h3>
                    <button id="close-support-modal" class="modal-close"><img src="icons/carver-icons/close_20x20.svg" alt="Close" width="20" height="20"></button>
                </div>
                <div class="modal-body">
                    <div class="support-content">
                        <p>Need help? Contact our support team:</p>
                        <div class="support-email">
                            <strong>support@carveragents.ai</strong>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="copy-support-email-btn" class="btn btn-primary">
                        <span class="btn-text">Copy Email</span>
                        <div class="btn-spinner hidden"></div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Share Summary Modal -->
        <div id="share-summary-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Update</h3>
                    <button id="close-share-modal" class="modal-close"><img src="icons/carver-icons/close_20x20.svg" alt="Close" width="20" height="20"></button>
                </div>
                <div class="modal-body">
                    <div class="share-content">
                        <div class="share-field">
                            <p id="share-title"></p>
                        </div>

                        <div class="share-field">
                            <strong>Summary</strong>
                            <p id="share-summary"></p>
                        </div>

                        <div class="share-field">
                            <strong>Source</strong>
                            <a id="share-url" href="#" target="_blank" rel="noopener noreferrer"></a>
                        </div>
                        
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="copy-share-btn" class="btn btn-primary">
                        <span class="btn-text">Copy to Clipboard</span>
                        <div class="btn-spinner hidden"></div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Overall Summary Share Modal -->
        <div id="overall-topic-summary-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Update</h3>
                    <button id="close-overall-topic-summary-modal" class="modal-close"><img src="icons/carver-icons/close_20x20.svg" alt="Close" width="20" height="20"></button>
                </div>
                <div class="modal-body">
                    <div class="share-content">
                        <div class="share-field">
                            <p id="overall-topic-summary-title"></p>
                        </div>

                        <div class="share-field">
                            <strong>Summary</strong>
                            <p id="overall-topic-summary-text"></p>
                        </div>

                        <div class="share-field">
                            <strong>Source</strong>
                            <a href="https://carveragents.ai" target="_blank" rel="noopener noreferrer">https://carveragents.ai</a>
                        </div>
                        
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="copy-overall-topic-summary-btn" class="btn btn-primary">
                        <span class="btn-text">Copy to Clipboard</span>
                        <div class="btn-spinner hidden"></div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Overall Partner Summary Share Modal -->
        <div id="overall-partner-summary-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Update</h3>
                    <button id="close-overall-partner-summary-modal" class="modal-close"><img src="icons/carver-icons/close_20x20.svg" alt="Close" width="20" height="20"></button>
                </div>
                <div class="modal-body">
                    <div class="share-content">
                        <div class="share-field">
                            <p id="overall-partner-summary-title"></p>
                        </div>

                        <div class="share-field">
                            <strong>Summary</strong>
                            <p id="overall-partner-summary-text"></p>
                        </div>

                        <div class="share-field">
                            <strong>Source</strong>
                            <a href="https://carveragents.ai" target="_blank" rel="noopener noreferrer">https://carveragents.ai</a>
                        </div>
                        
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="copy-overall-partner-summary-btn" class="btn btn-primary">
                        <span class="btn-text">Copy to Clipboard</span>
                        <div class="btn-spinner hidden"></div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Overall Summary Share Modal -->
        <div id="overall-summary-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Share Overall Summary</h3>
                    <button id="close-overall-summary-modal" class="modal-close"><img src="icons/carver-icons/close_20x20.svg" alt="Close" width="20" height="20"></button>
                </div>
                <div class="modal-body">
                    <div class="overall-summary-content">
                        <div class="summary-title-section">
                            <h4 id="overall-summary-title"></h4>
                        </div>
                        <div class="summary-text-section">
                            <p id="overall-summary-text"></p>
                        </div>
                        <div class="summary-footer">
                            <p>Generated on: <a href="https://carveragents.ai" target="_blank">https://carveragents.ai</a></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="copy-overall-summary-btn" class="btn btn-primary">
                        <span class="btn-text">Copy to Clipboard</span>
                        <div class="btn-spinner hidden"></div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Settings Screen -->
        <div id="settings-screen" class="screen hidden">
            <div class="header">
                <button id="settings-back-btn" class="icon-btn"><img src="icons/carver-icons/angle-small-left_back_20x20.svg" alt="Back" width="20" height="20"></button>
                <h1>Settings</h1>
            </div>
            
            <div class="content">
                <!-- User Profile Section -->
                <div class="user-profile-section">
                    <div class="user-details">
                        <h3 id="user-profile-name">Loading...</h3>
                        <p id="user-profile-email">Loading...</p>
                    </div>
                    <p class="settings-terms-text">
                        By using this Chrome extension, you acknowledge that you have read and understood, and agree to 
                        Carver Agents' <a href="https://carveragents.ai/terms-and-conditions" target="_blank">Terms</a> and <a href="https://carveragents.ai/privacy-policy" target="_blank">Privacy Policy</a>.
                    </p>
                </div>

                <div class="settings-section">
                    <h3>Account</h3>
                    <div class="setting-item">
                        <label>API Key</label>
                        <div class="api-key-display">
                            <span id="masked-api-key">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span>
                            <button id="show-api-key" class="btn btn-small">Show</button>
                        </div>
                    </div>
                    <button id="change-api-key" class="btn btn-secondary" style="display: none;">Change API Key</button>
                </div>

                <div class="settings-section">
                    <h3>Preferences</h3>
                    <div class="setting-item">
                        <label for="refresh-interval">Auto-refresh interval (minutes)</label>
                        <select id="refresh-interval">
                            <option value="5">5 minutes</option>
                            <option value="15" selected>15 minutes</option>
                            <option value="30">30 minutes</option>
                            <option value="60">1 hour</option>
                        </select>
                    </div>
                </div>

                <div class="settings-section">
                    <button id="logout-btn" class="btn btn-danger">Logout</button>
                </div>
            </div>
        </div>

        <!-- Error Screen -->
        <div id="error-screen" class="screen hidden">
            <div class="header">
                <h1>Error</h1>
            </div>
            <div class="content">
                <div class="error-message">
                    <p id="error-message-text"></p>
                    <button id="retry-btn" class="btn btn-primary">Retry</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container"></div>

    <script src="js/version.js"></script>
    <script src="js/sidepanel.js"></script>
</body>
</html>