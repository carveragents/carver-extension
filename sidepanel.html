<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carver</title>
    <link rel="stylesheet" href="styles/sidepanel.css">
</head>
<body>
    <div id="app">
        <!-- Loading State -->
        <div id="loading" class="screen">
            <div class="header">
                <h1>Carver</h1>
            </div>
            <div class="loading-spinner">
                <div class="spinner"></div>
                <p>Loading...</p>
            </div>
        </div>

        <!-- API Key Setup Screen -->
        <div id="api-key-setup" class="screen hidden">
            <div class="header">
                <div class="logo-title">
                    <img src="icons/icon32.png" alt="Carver" class="logo">
                    <h1>Carver</h1>
                </div>
                <div class="header-actions">
                    <button id="support-btn-setup" class="icon-btn" title="Support">üìß</button>
                </div>
            </div>
            <div class="content">
                <div class="welcome-section">
                    <p class="welcome-title">AI-powered market intelligence for financial services</p>
                    <p class="welcome-message">Stay informed with real-time regulatory updates, partner monitoring, and actionable insights. Get started by entering your API key below.</p>
                </div>
                <div class="form-group">
                    <label for="host-select">Environment</label>
                    <select id="host-select">
                        <option value="https://app.carveragents.ai">Production (app.carveragents.ai)</option>
                        <option value="https://app.staging.carveragents.ai">Staging (app.staging.carveragents.ai)</option>
                        <option value="http://localhost:8000">Local Development (localhost:8000)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="api-key-input">API Key</label>
                    <input type="password" id="api-key-input" placeholder="Enter your API key">
                    <div id="api-key-error" class="error-message hidden"></div>
                </div>
                <button id="validate-api-key" class="btn btn-primary">
                    <span class="btn-text">Validate Key</span>
                    <div class="btn-spinner hidden"></div>
                </button>
                
                <div class="footer-links">
                    <a href="https://carveragents.ai/terms" target="_blank" rel="noopener noreferrer">Terms & Conditions</a>
                    <span class="separator">‚Ä¢</span>
                    <a href="https://carveragents.ai/" target="_blank" rel="noopener noreferrer">Visit Website</a>
                    <span class="separator">‚Ä¢</span>
                    <span class="version-info" id="api-version"></span>
                </div>
            </div>
        </div>

        <!-- Main Dashboard Screen -->
        <div id="main-dashboard" class="screen hidden">
            <div class="header">
                <div class="logo-title">
                    <img src="icons/icon32.png" alt="Carver" class="logo">
                    <h1>Carver</h1>
                </div>
                <div class="user-info">
                    <span id="user-name"></span>
                    <button id="support-btn" class="icon-btn" title="Support">üìß</button>
                    <button id="settings-btn" class="icon-btn" title="Settings">‚öôÔ∏è</button>
                </div>
            </div>
            
            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button id="regulatory-tab" class="tab-btn active">üìã Regulatory</button>
                <button id="horizon-tab" class="tab-btn">üî≠ Partner Watch</button>
            </div>
            
            <div class="content">
                <!-- Regulatory Tab Content -->
                <div id="regulatory-content" class="tab-content">
                    <!-- Topics Header with Search -->
                    <div class="topics-header">
                        <div class="search-box">
                            <input type="text" id="topics-search-input" placeholder="Search for regulatory feeds...">
                            <div id="topics-suggestions" class="topics-suggestions hidden">
                                <!-- Topic suggestions will be dynamically inserted here -->
                            </div>
                        </div>
                        <div class="topics-actions">
                            <button id="subscriptions-btn" class="icon-btn" title="My Subscriptions">üìå</button>
                            <button id="refresh-btn" class="icon-btn" title="Refresh Topics">üîÑ</button>
                        </div>
                    </div>

                    <!-- Tag Summaries -->
                    <div id="tag-summaries" class="tag-summaries">
                        <!-- Tag cards will be dynamically inserted here -->
                    </div>

                    <!-- Empty State -->
                    <div id="empty-state" class="empty-state hidden">
                        <div class="empty-icon">üìä</div>
                        <h3>Start Monitoring Topics</h3>
                        <p>Search for regulatory topics to monitor</p>
                        <button id="search-topics-btn" class="btn btn-primary">Search Topics</button>
                    </div>
                    
                    <!-- Version Info for Regulatory Tab -->
                    <div class="tab-version-info">
                        <span class="version-info" id="regulatory-version"></span>
                    </div>
                </div>

                <!-- Partner Watch Tab Content -->
                <div id="horizon-content" class="tab-content hidden">
                    <!-- Partner Header with Search -->
                    <div class="partner-header">
                        <div class="search-box">
                            <input type="text" id="partner-search-input" placeholder="Search for partners...">
                            <div id="partner-suggestions" class="partner-suggestions hidden">
                                <!-- Partner suggestions will be dynamically inserted here -->
                            </div>
                        </div>
                        <div class="partner-actions">
                            <button id="horizon-refresh-btn" class="icon-btn" title="Refresh Partners">üîÑ</button>
                            <button id="add-partner-btn" class="icon-btn" title="Add Partner">+</button>
                        </div>
                    </div>

                    <!-- Partners List -->
                    <div id="partners-list" class="partners-list">
                        <!-- Partner items will be dynamically inserted here -->
                    </div>

                    <!-- Empty State for Partner Watch -->
                    <div id="partner-empty-state" class="empty-state hidden">
                        <div class="empty-icon">ü§ù</div>
                        <h3>Start Your Partner Watch</h3>
                        <p>Add partners to monitor news and developments</p>
                        <button id="add-first-partner-btn" class="btn btn-primary">Add Your First Partner</button>
                    </div>
                    
                    <!-- Version Info for Partner Watch Tab -->
                    <div class="tab-version-info">
                        <span class="version-info" id="partner-version"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tag Details Screen -->
        <div id="tag-details" class="screen hidden">
            <div class="header">
                <button id="back-btn" class="icon-btn">‚Üê Back</button>
                <h1 id="tag-details-title"></h1>
                <button id="subscribe-tag-btn" class="btn btn-small">
                    <span class="subscribe-text">Subscribe</span>
                    <span class="unsubscribe-text hidden">Unsubscribe</span>
                </button>
            </div>
            
            <div class="content">
                <!-- Tag Description -->
                <div class="tag-description">
                    <p id="tag-description"></p>
                </div>
                
                <!-- Tag Meta Summary -->
                <div class="meta-summary">
                    <h3>Summary</h3>
                    <p id="tag-meta-summary"></p>
                    <small id="tag-last-updated"></small>
                </div>

                <!-- Link Summaries -->
                <div class="link-summaries">
                    <h3>Recent Updates</h3>
                    <div id="link-list">
                        <!-- Link items will be dynamically inserted here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Search Results Screen -->
        <div id="search-results" class="screen hidden">
            <div class="header">
                <button id="search-back-btn" class="icon-btn">‚Üê Back</button>
                <h1>Browse Topics</h1>
            </div>
            
            <div class="content">
                <!-- Search Section on Search Screen -->
                <div class="search-section">
                    <div class="search-box">
                        <input type="text" id="search-input" placeholder="Search for topics...">
                        <button id="search-execute-btn" class="icon-btn">üîç</button>
                    </div>
                </div>
                
                <div id="search-results-list">
                    <!-- Search results will be dynamically inserted here -->
                </div>
                
                <div id="search-empty-state" class="empty-state hidden">
                    <p>No topics found matching your search.</p>
                </div>
            </div>
        </div>

        <!-- Subscriptions Screen -->
        <div id="subscriptions-screen" class="screen hidden">
            <div class="header">
                <button id="subscriptions-back-btn" class="icon-btn">‚Üê Back</button>
                <h1>My Subscriptions</h1>
            </div>
            
            <div class="content">
                <div id="subscriptions-list">
                    <!-- Subscriptions will be dynamically inserted here -->
                </div>
                
                <div id="subscriptions-empty-state" class="empty-state hidden">
                    <p>You haven't subscribed to any tags yet.</p>
                    <button id="browse-tags-btn" class="btn btn-primary">Browse Tags</button>
                </div>
            </div>
        </div>

        <!-- Edit Partner Modal -->
        <div id="edit-partner-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Edit Partner</h3>
                    <button id="close-edit-partner-modal" class="modal-close">√ó</button>
                </div>
                <div class="modal-body">
                    <form id="edit-partner-form">
                        <div class="form-group">
                            <label for="edit-partner-input">Partner Name</label>
                            <input type="text" id="edit-partner-input" placeholder="e.g., Microsoft, Tesla, Goldman Sachs" required>
                            <small>Enter a partner name to monitor for news and updates</small>
                            <div id="edit-partner-input-error" class="error-message hidden"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-frequency-select">Search Frequency</label>
                            <select id="edit-frequency-select">
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button id="cancel-edit-partner-btn" class="btn btn-secondary">Cancel</button>
                    <button id="save-edit-partner-btn" class="btn btn-primary">
                        <span class="btn-text">Update Partner</span>
                        <div class="btn-spinner hidden"></div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Add Partner Modal -->
        <div id="add-partner-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Add Partner Name</h3>
                    <button id="close-partner-modal" class="modal-close">√ó</button>
                </div>
                <div class="modal-body">
                    <form id="partner-form">
                        <div class="form-group">
                            <label for="partner-input">Partner Name</label>
                            <input type="text" id="partner-input" placeholder="e.g., Microsoft, Tesla, Goldman Sachs" required>
                            <small>Enter a partner name to monitor for news and updates</small>
                            <div id="partner-input-error" class="error-message hidden"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="frequency-select">Search Frequency</label>
                            <select id="frequency-select">
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button id="cancel-partner-btn" class="btn btn-secondary">Cancel</button>
                    <button id="save-partner-btn" class="btn btn-primary">
                        <span class="btn-text">Add Partner</span>
                        <div class="btn-spinner hidden"></div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Partner Details Modal -->
        <div id="partner-details-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="partner-details-title">Partner Details</h3>
                    <button id="close-partner-details" class="modal-close">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="meta-summary-section">
                        <h4>Latest Summary</h4>
                        <div id="partner-meta-summary" class="meta-summary-content">
                            <p class="no-summary">No summary available yet</p>
                        </div>
                        <div id="sentiment-indicator" class="sentiment-indicator hidden">
                            <span class="sentiment-label" id="sentiment-label"></span>
                            <div class="sentiment-bar">
                                <div class="sentiment-fill" id="sentiment-fill"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recent-summaries">
                        <h4>Recent Updates</h4>
                        <div id="recent-summaries-list">
                            <!-- Recent summaries will be loaded here -->
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <!-- Buttons removed as requested -->
                </div>
            </div>
        </div>

        <!-- Support Modal -->
        <div id="support-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Support</h3>
                    <button id="close-support-modal" class="modal-close">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="support-content">
                        <p>Need help? Contact our support team:</p>
                        <div class="support-email">
                            <strong>support@carveragents.ai</strong>
                        </div>
                        <p>Click the email to copy it to your clipboard.</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="copy-support-email-btn" class="btn btn-primary">
                        <span class="btn-text">Copy Email</span>
                        <div class="btn-spinner hidden"></div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Share Summary Modal -->
        <div id="share-summary-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Share Summary</h3>
                </div>
                <div class="modal-body">
                    <div class="share-content">
                        <div class="share-field">
                            <label>Title:</label>
                            <p id="share-title"></p>
                        </div>
                        <div class="share-field">
                            <label>URL:</label>
                            <p id="share-url"></p>
                        </div>
                        <div class="share-field">
                            <label>Summary:</label>
                            <p id="share-summary"></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="copy-share-btn" class="btn btn-primary">
                        <span class="btn-text">Copy to Clipboard</span>
                        <div class="btn-spinner hidden"></div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Settings Screen -->
        <div id="settings-screen" class="screen hidden">
            <div class="header">
                <button id="settings-back-btn" class="icon-btn">‚Üê Back</button>
                <h1>Settings</h1>
            </div>
            
            <div class="content">
                <div class="settings-section">
                    <h3>Account</h3>
                    <div class="setting-item">
                        <label for="settings-host-select">Environment</label>
                        <select id="settings-host-select">
                            <option value="https://app.carveragents.ai">Production (app.carveragents.ai)</option>
                            <option value="https://app.staging.carveragents.ai">Staging (app.staging.carveragents.ai)</option>
                            <option value="http://localhost:8000">Local Development (localhost:8000)</option>
                        </select>
                        <small>Changes take effect immediately</small>
                    </div>
                    <div class="setting-item">
                        <label>API Key</label>
                        <div class="api-key-display">
                            <span id="masked-api-key">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span>
                            <button id="show-api-key" class="btn btn-small">Show</button>
                        </div>
                    </div>
                    <button id="change-api-key" class="btn btn-secondary">Change API Key</button>
                </div>

                <div class="settings-section">
                    <h3>Preferences</h3>
                    <div class="setting-item">
                        <label for="refresh-interval">Auto-refresh interval (minutes)</label>
                        <select id="refresh-interval">
                            <option value="5">5 minutes</option>
                            <option value="15" selected>15 minutes</option>
                            <option value="30">30 minutes</option>
                            <option value="60">1 hour</option>
                        </select>
                    </div>
                </div>

                <div class="settings-section">
                    <button id="logout-btn" class="btn btn-danger">Logout</button>
                </div>
            </div>
        </div>

        <!-- Error Screen -->
        <div id="error-screen" class="screen hidden">
            <div class="header">
                <h1>Error</h1>
            </div>
            <div class="content">
                <div class="error-message">
                    <p id="error-message-text"></p>
                    <button id="retry-btn" class="btn btn-primary">Retry</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container"></div>

    <script src="js/version.js"></script>
    <script src="js/sidepanel.js"></script>
</body>
</html>